{{- include "stress-test-addons.env-job-template.from-pod" (list . "stress.network-example") -}}
{{- define "stress.network-example" -}}
metadata:
  labels:
    testInstance: "packet-loss-{{ .Release.Name }}-{{ .Release.Revision }}"
    testName: packet-loss
    chaos: "true"
spec:
  nodeSelector:
    sku: 'default'
  shareProcessNamespace: true
  containers:
    - name: network-example-sidecar
      command: ["bash", "-c", "tail -f /dev/null; exit 0"]
      imagePullPolicy: Always
      image: {{ .Stress.imageTag }}
      {{- include "stress-test-addons.container-env" . | nindent 6 }}
    - name: network-example
      command: ["bash", "-c", "yum install -y procps; sleep 10; kill `pidof tail`"]
      imagePullPolicy: Always
      image: {{ .Stress.imageTag }}
      {{- include "stress-test-addons.container-env" . | nindent 6 }}

{{- end -}}
